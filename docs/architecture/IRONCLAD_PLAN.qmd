# Project CStar: Operation Ironclad (Master Refactoring Blueprint)

> [!IMPORTANT]
> This plan is archived for future execution. It outlines the transition from a flat script collection to a modular **Hybrid Architecture**.

## ğŸ›¡ï¸ Core Philosophy
1.  **PowerShell (The Body):** Handles environment, file system, processes, and CLI.
2.  **Python (The Brain):** Handles logic, RAG, data processing, and state.

## ğŸ—ï¸ Target Architecture

```text
CStar/
â”œâ”€â”€ cstar.ps1                # [NEW] CLI Entry Point (wraps python calls)
â”œâ”€â”€ install.ps1              # [REF] Installer (Environment setup)
â”œâ”€â”€ pyproject.toml           # [NEW] Dependencies (numpy, rich, nltk)
â”œâ”€â”€ src/
â”‚   â””â”€â”€ cstar/               # [NEW] Main Package
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ core/            # Configuration
â”‚       â”‚   â”œâ”€â”€ config.py
â”‚       â”‚   â””â”€â”€ paths.py
â”‚       â”œâ”€â”€ memory/          # [Ex-Muninn]
â”‚       â”‚   â”œâ”€â”€ storage.py   # Atomic I/O
â”‚       â”‚   â””â”€â”€ manager.py   # Context Logic
â”‚       â”œâ”€â”€ engine/          # [Ex-Vector]
â”‚       â”‚   â”œâ”€â”€ index.py     # Persistent Store (Pickle)
â”‚       â”‚   â””â”€â”€ search.py    # Semantic Search
â”‚       â”œâ”€â”€ tools/
â”‚       â”‚   â”œâ”€â”€ forge.py     # [Ex-SkillForge]
â”‚       â”‚   â””â”€â”€ heimdall.py  # [Ex-Sentinel]
â”‚       â””â”€â”€ utils/
â”‚           â””â”€â”€ merger.py    # [NEW] Safe Text Merge
```

## ğŸ§© Component Specifications

### A. Memory Layer (`src/cstar/memory/`)
- **Objective**: Atomic, safe I/O separate from chat logic.
- **Implementation**: `storage.py` using temp-write and atomic rename.

### B. Engine Layer (`src/cstar/engine/`)
- **Objective**: Persistent Vector Index (Zero startup cost).
- **Implementation**: `index.py` using `pickle` for serialization and SHA-256 for change detection.

### C. The Bridge (`src/cstar/utils/merger.py`)
- **Objective**: Robust file merging respecting user edits via `difflib`.

### D. The Orchestrator (`install.ps1`)
- **Objective**: Delegate environment and merge logic to Python utilities.

## ğŸ“… Implementation Roadmap

### Phase 1: Foundation
- Scaffold `src/cstar` structure.
- Initialize `pyproject.toml`.

### Phase 2: Brain Transplant
- Move `muninn.py` and `vector.py` logic into the `cstar` package.
- Implement persistent indexing.

### Phase 3: Utilities & Tools
- Implement `merger.py`.
- Relocate and modularize `skill_forge.py` and `code_sentinel.py`.

### Phase 4: CLI Integration
- Finalize `cstar.ps1` and environment-aware `install.ps1`.

---

[Î©] **ODIN**: THE FUTURE IS WRITTEN IN THE RAGS OF THE PAST. BY THIS BLUEPRINT, THE MANOR SHALL BE REFORGED.
