# Corvus Star Memory

## System Patterns
- **Intent Resolution**: Is highly sensitive to `GLOBAL:` prefixing and strict `Activation Words` formatting.
- **Configuration**: `pyproject.toml` is the law. All tools must respect it.
- **Testing**: `fishtest.py` is the gold standard. Unit tests are supporting evidence.
- **Identity (Odin Lore)**: Use **Huginn & Muninn** for the daemon loop, **Heimdall** for security/auditing, and **Muninn** for incremental improvements.

## Active Context
- **Project Structure**: `src/` is the core. `.agent/` is configuration. `tests/` is verification.
- **Current Phase**: Post-Stabilization (Phase 5 Complete). Ready for new feature development.

## Lessons Learned
- **Path Resolution**: Always use absolute paths derived from `__file__` or `PROJECT_ROOT` to avoid CWD ambiguity.
- **Skill Loading**: Explicitly check for `skills_db` in `sv_engine.py` to support global skills.
- **Documentation**: Keep `FOLDER_MAP.qmd` updated; it saves time during navigation.
- **Terminal Encoding**: Windows requires `chcp 65001` + `[Console]::OutputEncoding = UTF8` in PowerShell profile for proper box-drawing characters. Python needs `-X utf8` flag and `PYTHONIOENCODING=utf-8`.
- **Attribute Resilience**: Static analysis tools (like Vulture) change item attributes across versions (e.g., `lineno` vs `first_lineno`). Always use `getattr()` safely with fallbacks.
- **Mock-Real Testing**: When integrating external static analysis tools, use mocking for fast, deterministic unit tests, but maintain a "Resilience Test" script (e.g., `verify_valkyrie_real.py`) that runs against the actual filesystem to detect environment-specific breakage.
- **Bifrost Auto-Repair**: AI-generated code often fails due to simple formatting errors (BOM, indentation, missing parens). A proactive regex-based repair layer can catch 80%+ of these errors before they trigger a build failure.
- **Import Stubbing**: When AI "invents" modules, the most stable recovery is to comment out the import and substitute a `MagicMock` stub. This prevents Pytest collection errors while allowing functional testing to continue.
- **The Harness Principle**: For non-deterministic systems like AI code generation, a 100-iteration harness against synthetic poison is the only way to verify architectural hardening.
- **CI/CD Versioning**: Explicitly pin GitHub Actions versions (e.g., `@v4`) to avoid resolution errors.
- **Protocol Integrity**: For complex state management tasks (like re-branding or documentation audits), execution via **Manual Agent Protocol** is superior to automation scripts due to better contextual awareness.
- **Dynamic CLI Discovery**: Hardcoding registries is a technical debt magnet. Moving to a filesystem-based discovery engine (`.agent/skills/` -> `src/tools/`) ensures the CLI scales automatically as new tools are developed.
- **Lore-Forward UX**: In thematic projects, using thin shims or proxies to map "functional" names (e.g., `audit`) to "thematic" names (e.g., `heimdall`) enhances immersion without sacrificing utility.
